print(predic.i[[1]])
}
}else{
cat("\n")
cat(crayon::black$bgCyan("  "),crayon::red$bold("Formula"),"\n")
print(nomo.reslut)
cat("\n")
cat(crayon::black$bgCyan("  "),crayon::red$bold("R2 and RMSE for each variable"),"\n")
print(test)
cat("\n")
cat(crayon::black$bgCyan("  "),crayon::red$bold("difference between predict and nomogram points, 5 digits as defaulted"),"\n")
for (i in 1:length(real_predict_list)){
predic.i=real_predict_list[i]
cat(crayon::black$bgWhite(names(predic.i)),"\n")
print(predic.i[[1]])
}
}
}
library(rms)
n <-1000
age <- rnorm(n,50,10)
sex <- factor(sample(c('female','male'),n,TRUE))
sex <- as.numeric(sex)
death <- ifelse(time <= cens,1,0)
cens <- 15*runif(n)
time <- -log(runif(n))/0.02*exp(.04*(age-50)+.8*(sex=='Female'))
time <- pmin(time,cens)
units(time)="month"
df <- data.frame(time,death,sex,age)
ddist <- datadist(df)
library(rms)
n <-1000
age <- rnorm(n,50,10)
sex <- factor(sample(c('female','male'),n,TRUE))
sex <- as.numeric(sex)
cens <- 15*runif(n)
time <- -log(runif(n))/0.02*exp(.04*(age-50)+.8*(sex=='Female'))
death <- ifelse(time <= cens,1,0)
time <- pmin(time,cens)
units(time)="month"
df <- data.frame(time,death,sex,age)
ddist <- datadist(df)
options(datadist='ddist')
f <- cph(formula(Surv(time,death)~sex+age),data=df,
x=TRUE,y=TRUE,surv=TRUE,time.inc=3)
surv <- Survival(f)
nomo <- nomogram(f,
lp=TRUE,
fun=list(function(x) surv(3,x),
function(x) surv(6,x)),
funlabel=c("3-Month Survival Prob",
"6-Month Survival Prob"))
#'
nomoFormu_points_cat(nomogram = nomo)
"%==%"<- function(a,b){
if (length(a)==1){
(1:length(b))[a == b]
}else if(length(a) > 1){
for (i in 1:length(a)) {
if (i==1){location=list()}
location.i=(1:length(b))[a[i] == b]
location=c(location,list(location.i))
names(location)[length(location)]=a[i]
}
location
}
}
#'
nomoFormu_points_cat(nomogram = nomo)
inner_Add_Symbol <- function(character,symbol="+"){
if (length(character)>=2){
for (character.i in 1:length(character)) {
if (character.i==1){
adj=character[1]
}else{
adj=paste0(adj,symbol,character[character.i])
}
}
}else{
adj=character
}
adj
}
#'
nomoFormu_points_cat(nomogram = nomo)
inner_Add_Symbol <- function(character,symbol="+"){
if (length(character)>=2){
for (character.i in 1:length(character)) {
if (character.i==1){
adj=character[1]
}else{
adj=paste0(adj,symbol,character[character.i])
}
}
}else{
adj=character
}
adj
}
inner_Add_Symbol <- function(character,symbol="+"){
if (length(character)>=2){
for (character.i in 1:length(character)) {
if (character.i==1){
adj=character[1]
}else{
adj=paste0(adj,symbol,character[character.i])
}
}
}else{
adj=character
}
adj
}
#'
nomoFormu_points_cat(nomogram = nomo)
cat(crayon::black$bgCyan("  "),crayon::red$bold(tmcn::toUTF8("\u6BD4\u8F83\u6BCF\u4E2A\u53D8\u91CF\u7684nomogram\u5F97\u5206\u548C\u9884\u6D4B\u5F97\u5206,\u5DEE\u503C(diff)\u4FDD\u75595\u4F4D\u5C0F\u6570")),"\n")
cat(crayon::black$bgCyan("  "),crayon::red$bold(tmcn::toUTF8("\u6BD4\u8F83\u6BCF\u4E2A\u53D8\u91CF\u7684nomogram\u5F97\u5206\u548C\u9884\u6D4B\u5F97\u5206")),"\n")
#'
nomoFormu_points_cat(nomogram = nomo)
nomoFormu_points_cat(nomogram = nomo,power = 2)
nomoFormu_points_cat(nomogram = nomo,power = 3)
library(devtools)
document()
devtools::load_all(".")
library(nomogramFormula)
library(nomogramFormula)
library(rms)
n <-1000
age <- rnorm(n,50,10)
sex <- factor(sample(c('female','male'),n,TRUE))
sex <- as.numeric(sex)
cens <- 15*runif(n)
time <- -log(runif(n))/0.02*exp(.04*(age-50)+.8*(sex=='Female'))
death <- ifelse(time <= cens,1,0)
time <- pmin(time,cens)
units(time)="month"
df <- data.frame(time,death,sex,age)
ddist <- datadist(df)
options(datadist='ddist')
f <- cph(formula(Surv(time,death)~sex+age),data=df,
x=TRUE,y=TRUE,surv=TRUE,time.inc=3)
surv <- Survival(f)
nomo <- nomogram(f,
lp=TRUE,
fun=list(function(x) surv(3,x),
function(x) surv(6,x)),
funlabel=c("3-Month Survival Prob",
"6-Month Survival Prob"))
library(nomogramFormula)
nomoFormu_points_cat(nomogram = nomo)
nomoFormu_points_cat(nomogram = nomo,power = 1)
nomoFormu_points_cat(nomogram = nomo,power = 2)
nomoFormu_points_cat(nomogram = nomo,power = 3)
n <-2019
age <- rnorm(n,50,10)
age <- rnorm(n,60,20)
sex <- factor(sample(c('female','male'),n,TRUE))
sex <- as.numeric(sex)
sex
cens <- 15*runif(n)
cens
runif(n)
weight <- rnorm(n,60,10)
time <- -log(runif(n))/0.02*exp(.04*(age-60)+
.6*(sex=='male')+
0.8*(weight-60))
pmin
time
round(time)
round(time,1)
time <- -log(runif(n))/0.02*exp(.04*(age-60)+
.6*(sex=='male')+
0.08*(weight-60))
time
time <- -log(runif(n))/0.02*exp(.04*(age-60)+
.6*(sex=='male')+
0.8*(weight-60))
cens <- 25*runif(n)
cens
mean(cens)
death <- ifelse(time <= cens,1,0)
death
table(death)
cens <- 15*runif(n)
death <- ifelse(time <= cens,1,0)
table(death)
cens <- 5*runif(n)
death <- ifelse(time <= cens,1,0)
table(death)
time <- -log(runif(n))/0.02*exp(.04*(age-60)+
.6*(sex=='male')+
0.08*(weight-60))
cens <- 5*runif(n)
death <- ifelse(time <= cens,1,0)
table(death)
time <- -log(runif(n))/0.02*exp(.04*(age-60)+
.06*(sex=='male')+
0.08*(weight-60))
cens <- 5*runif(n)
death <- ifelse(time <= cens,1,0)
table(death)
cens <- 0.5*runif(n)
death <- ifelse(time <= cens,1,0)
table(death)
cens <- 25*runif(n)
death <- ifelse(time <= cens,1,0)
table(death)
cens <- 35*runif(n)
death <- ifelse(time <= cens,1,0)
table(death)
cens <- 50*runif(n)
death <- ifelse(time <= cens,1,0)
table(death)
cens <- 100*runif(n)
death <- ifelse(time <= cens,1,0)
table(death)
range(time)
time <- rnorm(n,720,365)
range(time)
time <- rnorm(n,720,100)
n <-2019
age <- rnorm(n,60,20)
sex <- factor(sample(c('female','male'),n,TRUE))
sex <- as.numeric(sex)
weight <- rnorm(n,60,10)
time <- rnorm(n,720,100)
range(time)
cens <- 100*runif(n)
range(cens)
mean(cens)
cens <- 200*runif(n)
range(cens)
mean(cens)
cens <- 365*runif(n)
range(cens)
mean(cens)
cens <- 365*runif(n)
death <- ifelse(time <= cens,1,0)
table(death)
range(time)
death <- sample(c(1,0),n)
death <- sample(c(1,0),n,replace = TRUE)
death <- sample(c(1,0),n,replace = TRUE,prob = 0.7)
death <- sample(c(1,0),n,replace = TRUE)
table(death)
n <-2019
age <- rnorm(n,60,20)
sex <- factor(sample(c('female','male'),n,TRUE))
sex <- as.numeric(sex)
weight <- rnorm(n,60,10)
time <- rnorm(n,720,100)
range(time)
death <- sample(c(1,0),n,replace = TRUE)
table(death)
set.seed(2019)
n <-2019
age <- rnorm(n,60,20)
sex <- factor(sample(c('female','male'),n,TRUE))
sex <- as.numeric(sex)
weight <- rnorm(n,60,10)
time <- rnorm(n,720,100)
range(time)
death <- sample(c(1,0),n,replace = TRUE)
table(death)
set.seed(2019)
n <-2019
age <- rnorm(n,60,20)
sex <- factor(sample(c('female','male'),n,TRUE))
sex <- as.numeric(sex)
weight <- rnorm(n,60,10)
time <- rnorm(n,720,100)
range(time)
death <- sample(c(1,0),n,replace = TRUE)
table(death)
set.seed(2018)
n <-2019
age <- rnorm(n,60,20)
sex <- factor(sample(c('female','male'),n,TRUE))
sex <- as.numeric(sex)
weight <- rnorm(n,60,10)
time <- rnorm(n,720,100)
range(time)
death <- sample(c(1,0),n,replace = TRUE)
table(death)
set.seed(2018)
n <-2019
age <- rnorm(n,60,20)
sex <- factor(sample(c('female','male'),n,TRUE))
sex <- as.numeric(sex)
weight <- rnorm(n,60,10)
time <- rnorm(n,720,100)
range(time)
death <- sample(c(1,0),n,replace = TRUE)
table(death)
set.seed(2018)
n <-2019
age <- rnorm(n,60,20)
sex <- factor(sample(c('female','male'),n,TRUE))
sex <- as.numeric(sex)
weight <- rnorm(n,60,10)
time <- rnorm(n,720,100)
range(time)
death <- sample(c(1,0),n,replace = TRUE)
table(death)
set.seed(2018)
n <-2019
age <- rnorm(n,60,20)
sex <- factor(sample(c('female','male'),n,TRUE))
sex <- as.numeric(sex)
weight <- rnorm(n,60,10)
time <- rnorm(n,720,100)
range(time)
death <- sample(c(1,0),n,replace = TRUE)
table(death)
range(time)
table(death)
death <- sample(c(1,0),n,replace = TRUE)
df <- data.frame(time,death,age,sex,weight)
ddist <- datadist(df)
options(datadist='ddist')
f <- cph(formula(Surv(time,death)~sex+age),data=df,
x=TRUE,y=TRUE,surv=TRUE,time.inc=3)
surv <- Survival(f)
units(time)="day"
death <- sample(c(1,0),n,replace = TRUE)
df <- data.frame(time,death,age,sex,weight)
ddist <- datadist(df)
options(datadist='ddist')
f <- cph(formula(Surv(time,death)~sex+age),data=df,
x=TRUE,y=TRUE,surv=TRUE,time.inc=3)
surv <- Survival(f)
surv <- Survival(f)
nomo <- nomogram(f,
lp=TRUE,
fun=list(function(x) surv(365,x),
function(x) surv(365*2,x)),
funlabel=c("1-Year Survival Prob",
"2-Year Survival Prob"))
plot(nomo)
nomo <- nomogram(f,
lp=TRUE,
fun=list(function(x) surv(365*3,x),
function(x) surv(365*2,x)),
funlabel=c("1-Year Survival Prob",
"2-Year Survival Prob"))
nomo <- nomogram(f,
lp=TRUE,
fun=list(function(x) surv(365*3,x),
function(x) surv(365*2,x)),
funlabel=c("1-Year Survival Prob",
"2-Year Survival Prob"))
time <- sample(50:800,n,replace = TRUE)
units(time)="day"
death <- sample(c(1,0),n,replace = TRUE)
df <- data.frame(time,death,age,sex,weight)
ddist <- datadist(df)
options(datadist='ddist')
f <- cph(formula(Surv(time,death)~sex+age),data=df,
x=TRUE,y=TRUE,surv=TRUE,time.inc=3)
surv <- Survival(f)
nomo <- nomogram(f,
lp=TRUE,
fun=list(function(x) surv(365,x),
function(x) surv(365*2,x)),
funlabel=c("1-Year Survival Prob",
"2-Year Survival Prob"))
plot(nomo)
weight <- sample(50:100,n,replace = TRUE)
time <- sample(50:800,n,replace = TRUE)
units(time)="day"
death <- sample(c(1,0),n,replace = TRUE)
df <- data.frame(time,death,age,sex,weight)
ddist <- datadist(df)
options(datadist='ddist')
f <- cph(formula(Surv(time,death)~sex+age),data=df,
x=TRUE,y=TRUE,surv=TRUE,time.inc=3)
surv <- Survival(f)
nomo <- nomogram(f,
lp=TRUE,
fun=list(function(x) surv(365,x),
function(x) surv(365*2,x)),
funlabel=c("1-Year Survival Prob",
"2-Year Survival Prob"))
plot(nomo)
set.seed(2018)
n <-2019
age <- rnorm(n,60,20)
sex <- factor(sample(c('female','male'),n,TRUE))
sex <- as.numeric(sex)
weight <- sample(50:100,n,replace = TRUE)
time <- sample(50:800,n,replace = TRUE)
units(time)="day"
death <- sample(c(1,0),n,replace = TRUE)
df <- data.frame(time,death,age,sex,weight)
ddist <- datadist(df)
options(datadist='ddist')
f <- cph(formula(Surv(time,death)~sex+age+weight),data=df,
x=TRUE,y=TRUE,surv=TRUE,time.inc=3)
surv <- Survival(f)
nomo <- nomogram(f,
lp=TRUE,
fun=list(function(x) surv(365,x),
function(x) surv(365*2,x)),
funlabel=c("1-Year Survival Prob",
"2-Year Survival Prob"))
plot(nomo)
set.seed(2018)
n <-2019
age <- rnorm(n,60,20)
sex <- factor(sample(c('female','male'),n,TRUE))
sex <- as.numeric(sex)
weight <- sample(50:100,n,replace = TRUE)
time <- sample(50:800,n,replace = TRUE)
units(time)="day"
death <- sample(c(1,1,0),n,replace = TRUE)
table(death)
set.seed(2018)
n <-2019
age <- rnorm(n,60,20)
sex <- factor(sample(c('female','male'),n,TRUE))
sex <- as.numeric(sex)
weight <- sample(50:100,n,replace = TRUE)
time <- sample(50:800,n,replace = TRUE)
units(time)="day"
death <- sample(c(1,1,0),n,replace = TRUE)
table(death)
set.seed(2018)
n <-2019
age <- rnorm(n,60,20)
sex <- factor(sample(c('female','male'),n,TRUE))
sex <- as.numeric(sex)
weight <- sample(50:100,n,replace = TRUE)
time <- sample(50:800,n,replace = TRUE)
units(time)="day"
death <- sample(c(1,1,0),n,replace = TRUE)
table(death)
df <- data.frame(time,death,age,sex,weight)
ddist <- datadist(df)
options(datadist='ddist')
f <- cph(formula(Surv(time,death)~sex+age+weight),data=df,
x=TRUE,y=TRUE,surv=TRUE,time.inc=3)
surv <- Survival(f)
nomo <- nomogram(f,
lp=TRUE,
fun=list(function(x) surv(365,x),
function(x) surv(365*2,x)),
funlabel=c("1-Year Survival Prob",
"2-Year Survival Prob"))
plot(nomo)
death <- sample(c(1,0,0),n,replace = TRUE)
set.seed(2018)
n <-2019
age <- rnorm(n,60,20)
sex <- factor(sample(c('female','male'),n,TRUE))
sex <- as.numeric(sex)
weight <- sample(50:100,n,replace = TRUE)
time <- sample(50:800,n,replace = TRUE)
units(time)="day"
death <- sample(c(1,0,0),n,replace = TRUE)
df <- data.frame(time,death,age,sex,weight)
ddist <- datadist(df)
options(datadist='ddist')
f <- cph(formula(Surv(time,death)~sex+age+weight),data=df,
x=TRUE,y=TRUE,surv=TRUE,time.inc=3)
surv <- Survival(f)
nomo <- nomogram(f,
lp=TRUE,
fun=list(function(x) surv(365,x),
function(x) surv(365*2,x)),
funlabel=c("1-Year Survival Prob",
"2-Year Survival Prob"))
plot(nomo)
#'
library(nomogramFormula)
nomoFormu_points_cat(nomogram = nomo)
nomoFormu_points_cat(nomogram = nomo,power = 1)
nomoFormu_probability_cat(nomogram = nomo,power = 1)
nomoFormu_probability_cat(nomogram = nomo,power = 1)
nomoFormu_probability_cat(nomogram = nomo,power = 2)
library(devtools)
document()
devtools::load_all(".")
devtools::load_all(".")
library(nomogramFormula)
library(nomogramFormula)
devtools::load_all(".")
library(nomogramFormula)
document()
library(devtools)
document()
library(nomogramFormula)
library(rms)
library(devtools)
document()
install()
library(devtools)
document()
document()
install()
library(devtools)
document()
document()
document()
install()
library(devtools)
document()
install()
library(devtools)
document()
install()
library(nomogramFormula)
devtools::load_all(".")
